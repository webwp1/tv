<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moje TV</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.ui.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/controls.min.css">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: sans-serif; overflow: hidden; }
        #menu { 
            position: absolute; top: 0; left: 0; width: 100%; height: 60px; 
            background: rgba(0,0,0,0.9); z-index: 10; display: flex; align-items: center; 
            padding: 0 15px; border-bottom: 1px solid #333;
        }
        .channel-btn {
            background: #222; color: white; border: 1px solid #444; padding: 10px 18px;
            margin-right: 10px; cursor: pointer; border-radius: 5px; font-weight: bold; transition: 0.3s;
        }
        .channel-btn:hover { background: #333; }
        .channel-btn.active { background: #e50914; border-color: #e50914; }
        #video-container { width: 100%; height: calc(100% - 60px); margin-top: 60px; }
        video { width: 100%; height: 100%; }
    </style>
</head>
<body>

    <div id="menu">
        <button class="channel-btn active" onclick="changeChannel('ns1', this)">Nova Sport 1 (Antik)</button>
        <button class="channel-btn" onclick="changeChannel('ns2_antik', this)">Nova Sport 2 (Antik)</button>
        <button class="channel-btn" onclick="changeChannel('ns2_strumyk', this)">Nova Sport 2 (Záloha)</button>
    </div>

    <div id="video-container" data-shaka-player-container>
        <video autoplay data-shaka-player id="video" muted></video>
    </div>

    <script>
        const streams = {
            'ns1': 'https://dash4.antik.sk/stream/nvidia_nova_sport1/playlist_cbcs.mpd',
            'ns2_antik': 'https://dash4.antik.sk/stream/nvidia_nova_sport2/playlist_cbcs.mpd',
            'ns2_strumyk': 'https://45d4f5xxx.win/strumyk/hls/event27/index.m3u8?jwt=MTQ5LjEwMi4yMzUuMTc2fDE3NzE3MzExNzd8ZXZlbnQyNy5tM3U4fDF4TXZTQzdQTWVpYlBzRFU3REo0ZlFDb0k5Nng0TzNIUVUyOEF1SzhhTE0'
        };

        const clearKeys = {
            "11223344556677889900112233445566": "4b80724d0ef86bcb2c21f7999d67739d"
        };

        let player;

        async function initPlayer() {
            const video = document.getElementById('video');
            const ui = video['ui'];
            player = ui.getControls().getPlayer();

            player.configure({ drm: { clearKeys: clearKeys } });

            try {
                await player.load(streams['ns1']);
            } catch (e) { console.error('Chyba:', e); }
        }

        async function changeChannel(id, btn) {
            document.querySelectorAll('.channel-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            try {
                // Přepínání DRM podle zdroje
                if (id === 'ns2_strumyk') {
                    // Strumyk (HLS) nepotřebuje klíče
                    player.configure({ drm: { clearKeys: {} } });
                } else {
                    // Antik potřebuje klíče
                    player.configure({ drm: { clearKeys: clearKeys } });
                }

                await player.load(streams[id]);
            } catch (e) {
                console.error('Chyba při přepínání:', e);
                alert('Tento zdroj nefunguje (pravděpodobně vypršel token nebo je blokován).');
            }
        }

        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('shaka-ui-loaded', initPlayer);
    </script>
</body>
</html>
